<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>rom: LSPG: hyper-reduced problem | Pressio|C++</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,400i,600,600i%7CSource+Code+Pro:400,400i,600" />
  <link rel="stylesheet" href="m-dark+documentation.compiled.css" />
  <link rel="icon" href="favicon.ico" type="image/x-icon" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#22272e" />
</head>
<body>
<header><nav id="navigation">
  <div class="m-container">
    <div class="m-row">
      <a href="index.html" id="m-navbar-brand" class="m-col-t-8 m-col-m-none m-left-m">Pressio|C++</a>
      <div class="m-col-t-4 m-hide-m m-text-right m-nopadr">
        <a href="#search" class="m-doc-search-icon" title="Search" onclick="return showSearch()"><svg style="height: 0.9rem;" viewBox="0 0 16 16">
          <path id="m-doc-search-icon-path" d="m6 0c-3.31 0-6 2.69-6 6 0 3.31 2.69 6 6 6 1.49 0 2.85-0.541 3.89-1.44-0.0164 0.338 0.147 0.759 0.5 1.15l3.22 3.79c0.552 0.614 1.45 0.665 2 0.115 0.55-0.55 0.499-1.45-0.115-2l-3.79-3.22c-0.392-0.353-0.812-0.515-1.15-0.5 0.895-1.05 1.44-2.41 1.44-3.89 0-3.31-2.69-6-6-6zm0 1.56a4.44 4.44 0 0 1 4.44 4.44 4.44 4.44 0 0 1-4.44 4.44 4.44 4.44 0 0 1-4.44-4.44 4.44 4.44 0 0 1 4.44-4.44z"/>
        </svg></a>
        <a id="m-navbar-show" href="#navigation" title="Show navigation"></a>
        <a id="m-navbar-hide" href="#" title="Hide navigation"></a>
      </div>
      <div id="m-navbar-collapse" class="m-col-t-12 m-show-m m-col-m-none m-right-m">
        <div class="m-row">
          <ol class="m-col-t-12 m-col-m-none">
            <li><a href="md_pages_introduction.html">Introduction</a></li>
            <li><a href="md_pages_installation.html">Installation</a></li>
            <li>
              <a>Documentation/A</a>
              <ol>
                <li><a href="md_pages_components_mpl.html">mpl</a></li>
                <li><a href="md_pages_components_utils.html">utils</a></li>
                <li><a href="md_pages_components_type_traits.html">type_traits</a></li>
                <li><a href="md_pages_components_expressions.html">expressions</a></li>
                <li><a href="md_pages_components_ops.html">ops</a></li>
                <li><a href="md_pages_components_qr.html">qr</a></li>
                <li><a href="md_pages_components_linsolvers.html">linear solvers</a></li>
                <li><a> nonlinear solvers: </a></li>
                <li><a href="md_pages_components_nonlinsolvers_general.html"> &emsp; - general info</a></li>
                <li><a href="md_pages_components_nonlinsolvers_system_api.html"> &emsp; - problem class API</a></li>
                <li><a href="md_pages_components_nonlinsolvers_nr.html"> &emsp; - Newton-Raphson</a></li>
                <li><a href="md_pages_components_nonlinsolvers_gn.html"> &emsp; - Gauss-Newton</a></li>
                <li><a href="md_pages_components_nonlinsolvers_lm.html"> &emsp; - Levenberg-Marquardt</a></li>
                <li><a href="md_pages_components_nonlinsolvers_irls.html"> &emsp; - irls</a></li>
                <li><a> ode: </a></li>
                <li><a href="md_pages_components_ode_advance.html"> &emsp; - advancers</a></li>
                <li><a href="md_pages_components_ode_steppers_explicit.html"> &emsp; - explicit steppers</a></li>
                <li><a href="md_pages_components_ode_steppers_implicit.html"> &emsp; - implicit steppers</a></li>
              </ol>
            </li>
            <li>
              <a>Documentation/B</a>
              <ol>
                <li><a> rom: </a></li>
                <li><a href="md_pages_components_rom_fom_apis.html"> &emsp; - FOM adapter API</a></li>
                <li><a href="md_pages_components_rom_decoder.html">  &emsp; - decoder</a></li>
                <li><a href="md_pages_components_rom_galerkin.html"> &emsp; - Galerkin </a></li>
                <li><a href="md_pages_components_rom_galerkin_default.html"> &emsp; &emsp; - default problem </a></li>
                <li><a href="md_pages_components_rom_galerkin_hypred.html"> &emsp; &emsp; - hyper-reduced problem </a></li>
                <li><a href="md_pages_components_rom_galerkin_masked.html"> &emsp; &emsp; - masked problem </a></li>
                <li><a href="md_pages_components_rom_lspg_steady.html"> &emsp; - LSPG: steady </a></li>
                <li><a href="md_pages_components_rom_lspg_default_steady.html"> &emsp; &emsp; - default problem </a></li>
                <li><a href="md_pages_components_rom_lspg_hypred_steady.html"> &emsp; &emsp; - hyper-reduced problem </a></li>
                <li><a href="md_pages_components_rom_lspg_masked_steady.html"> &emsp; &emsp; - masked problem </a></li>
                <li><a href="md_pages_components_rom_lspg_unsteady.html"> &emsp; - LSPG: unsteady </a></li>
                <li><a href="md_pages_components_rom_lspg_default.html"> &emsp; &emsp; - default problem </a></li>
                <li><a href="md_pages_components_rom_lspg_hypred.html"> &emsp; &emsp; - hyper-reduced problem </a></li>
                <li><a href="md_pages_components_rom_lspg_masked.html"> &emsp; &emsp; - masked problem </a></li>
                <li><a href="md_pages_components_rom_wls.html">rom: WLS</a></li>
              </ol>
            </li>
            <li><a href="https://pressio.github.io/pressio-tutorials">Tutorials</a></li>
            <li><a href="https://github.com/Pressio/pressio">Github</a></li>
          </ol>
          <ol class="m-col-t-6 m-col-m-none" start="7">
            <li class="m-show-m"><a href="#search" class="m-doc-search-icon" title="Search" onclick="return showSearch()"><svg style="height: 0.9rem;" viewBox="0 0 16 16">
              <use href="#m-doc-search-icon-path" />
            </svg></a></li>
          </ol>
        </div>
      </div>
    </div>
  </div>
</nav></header>
<main><article>
  <div class="m-container m-container-inflatable">
    <div class="m-row">
      <div class="m-col-l-10 m-push-l-1">
        <h1>
          rom: LSPG: hyper-reduced problem
        </h1>
<div class="m-note m-default"><p>Defined in: <code>&lt;pressio/rom_lspg.hpp&gt;</code></p><p>Public namespace: <code>pressio::rom::lspg</code></p></div><p><br /></p><aside class="m-block m-warning"><h3>Prerequisite reading:</h3><p>Before you read this page, make sure you read the <a href="md_pages_components_rom_lspg_unsteady.html">overall design idea of the unsteady LSPG</a>.</p></aside><section id="autotoc_md120"><h2><a href="#autotoc_md120">API</a></h2><pre class="m-code"><span class="c1">// overload for continuous-time systems</span>
<span class="k">template</span><span class="o">&lt;</span>
  <span class="k">class</span> <span class="nc">FomSystemType</span><span class="p">,</span>
  <span class="k">class</span> <span class="nc">DecoderType</span><span class="p">,</span>
  <span class="k">class</span> <span class="nc">RomStateType</span><span class="p">,</span>                                                             <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
  <span class="k">class</span> <span class="nc">FomReferenceStateType</span><span class="p">,</span>
  <span class="k">class</span> <span class="nc">HypRedOperatorUpdaterType</span>
  <span class="o">&gt;</span>
<span class="n">ReturnType</span> <span class="n">create_hyperreduced_unsteady_problem</span><span class="p">(</span><span class="n">pressio</span><span class="o">::</span><span class="n">ode</span><span class="o">::</span><span class="n">StepScheme</span> <span class="n">scheme</span><span class="p">,</span>
                                                <span class="k">const</span> <span class="n">FomSystemType</span> <span class="o">&amp;</span> <span class="n">fomSystem</span><span class="p">,</span>
                                                <span class="n">DecoderType</span> <span class="o">&amp;</span> <span class="n">decoder</span><span class="p">,</span>
                                                <span class="k">const</span> <span class="n">RomStateType</span> <span class="o">&amp;</span> <span class="n">romState</span><span class="p">,</span>
                                                <span class="k">const</span> <span class="n">FomReferenceStateType</span> <span class="o">&amp;</span> <span class="n">fomRefState</span><span class="p">,</span>
                                                <span class="k">const</span> <span class="n">HypRedOperatorUpdaterType</span> <span class="o">&amp;</span> <span class="n">hrUpdater</span><span class="p">)</span>

<span class="c1">// overload for discrete-time systems</span>
<span class="k">template</span><span class="o">&lt;</span>
  <span class="n">std</span><span class="o">::</span><span class="kt">size_t</span> <span class="n">num_states</span><span class="p">,</span>
  <span class="k">class</span> <span class="nc">FomSystemType</span><span class="p">,</span>
  <span class="k">class</span> <span class="nc">DecoderType</span><span class="p">,</span>
  <span class="k">class</span> <span class="nc">RomStateType</span><span class="p">,</span>                                                             <span class="p">(</span><span class="mi">2</span><span class="p">)</span>
  <span class="k">class</span> <span class="nc">FomReferenceStateType</span>
  <span class="o">&gt;</span>
<span class="n">ReturnType</span> <span class="n">create_hyperreduced_unsteady_problem</span><span class="p">(</span><span class="k">const</span> <span class="n">FomSystemType</span> <span class="o">&amp;</span> <span class="n">fomSystem</span><span class="p">,</span>
                                                <span class="n">DecoderType</span> <span class="o">&amp;</span> <span class="n">decoder</span><span class="p">,</span>
                                                <span class="k">const</span> <span class="n">RomStateType</span> <span class="o">&amp;</span> <span class="n">romState</span><span class="p">,</span>
                                                <span class="k">const</span> <span class="n">FomReferenceStateType</span> <span class="o">&amp;</span> <span class="n">fomRefState</span><span class="p">);</span></pre><section id="autotoc_md121"><h3><a href="#autotoc_md121">Parameters and Requirements</a></h3><ul><li><code>fomSystem</code>:<ul><li>instance of your adapter class type specifying the FOM problem</li><li>for 1: must satisfy the <a href="./md_pages_components_rom_fom_apis.html">continuous-time API</a></li><li>for 2: must satisfy the <a href="./md_pages_components_rom_fom_apis.html">discrete-time API</a></li></ul></li><li><code>decoder</code>:<ul><li>decoder object</li><li>must satify the requirements listed <a href="md_pages_components_rom_decoder.html">here</a></li></ul></li><li><code>romState</code>:<ul><li>currently, it must be either an Eigen vector or a Kokkos 1D view</li></ul></li><li><code>fomRefState</code>:<ul><li>your FOM reference state that is used when reconstructing the FOM state</li><li>must be copy-constructible and the following must be true:<br /> <code class="m-code"><span class="n">std</span><span class="o">::</span><span class="n">is_same</span><span class="o">&lt;</span><span class="n">FomReferenceStateType</span><span class="p">,</span> <span class="k">typename</span> <span class="nc">DecoderType</span><span class="o">::</span><span class="n">fom_state_type</span><span class="o">&gt;::</span><span class="n">value</span> <span class="o">==</span> <span class="nb">true</span></code></li></ul></li><li><code>hrUpdater</code>:<ul><li>an instance of class that knows how to update operands that live on the stencil and sample mesh.</li><li>must meet the following interface:</li></ul></li></ul><pre class="m-code"><span class="k">struct</span> <span class="nc">HypRedUpdater</span>
<span class="p">{</span>
  <span class="k">using</span> <span class="n">operand_type1</span> <span class="o">=</span> <span class="cm">/*should be the type of your fom velocity*/</span><span class="p">;</span>
  <span class="k">using</span> <span class="n">operand_type2</span> <span class="o">=</span> <span class="cm">/*should be the type of your decoder&#39;s jacobian*/</span><span class="p">;</span>

  <span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">ScalarType</span><span class="o">&gt;</span>
  <span class="kt">void</span> <span class="n">updateSampleMeshOperandWithStencilMeshOne</span><span class="p">(</span><span class="n">operand_type1</span> <span class="o">&amp;</span> <span class="n">operand_on_sample</span><span class="p">,</span>
                                                 <span class="n">ScalarType</span> <span class="n">alpha</span><span class="p">,</span>
                                                 <span class="k">const</span> <span class="n">operand_type1</span> <span class="o">&amp;</span> <span class="n">operand_on_stencil</span><span class="p">,</span>
                                                 <span class="n">ScalarType</span> <span class="n">beta</span><span class="p">)</span> <span class="k">const</span>
  <span class="p">{</span>
    <span class="c1">// appropriately compute:</span>
    <span class="c1">// operand_on_sample = alpha*operand_on_sample + beta*operand_on_stencil</span>
  <span class="p">}</span>

  <span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">ScalarType</span><span class="o">&gt;</span>
  <span class="kt">void</span> <span class="n">updateSampleMeshOperandWithStencilMeshOne</span><span class="p">(</span><span class="n">operand_type2</span> <span class="o">&amp;</span> <span class="n">operand_on_sample</span><span class="p">,</span>
                                                 <span class="n">ScalarType</span> <span class="n">alpha</span><span class="p">,</span>
                                                 <span class="k">const</span> <span class="n">operand_type2</span> <span class="o">&amp;</span> <span class="n">operand_on_stencil</span><span class="p">,</span>
                                                 <span class="n">ScalarType</span> <span class="n">beta</span><span class="p">)</span> <span class="k">const</span>
  <span class="p">{</span>
    <span class="c1">// appropriately compute:</span>
    <span class="c1">// operand_on_sample = alpha*operand_on_sample + beta*operand_on_stencil</span>
  <span class="p">}</span>
<span class="p">};</span></pre><ul><li><code>num_states</code>:<ul><li><em>total</em> number of states you need to use (must be &lt;= 3), if you need more open issue</li><li>only needed for the discrete-time case</li></ul></li></ul><p><br /></p></section></section><section id="autotoc_md122"><h2><a href="#autotoc_md122">Why do we need the HypRedUpdater?</a></h2><p>When working with a hyper-reduced problem, pressio has to manipulate objects that have different sizes/distributions. For this problem variant, in fact, some operators are naturally defined on the what we refer to as &quot;sample mesh&quot; while some are defined on what we call the &quot;stencil mesh&quot;.</p><p>As explained <a href="https://pressio.github.io/algos/hyper/">here</a>, recall that:</p><ol><li><strong>sample mesh</strong>: a disjoint collection of elements where the velocity (or residual) operator is computed.</li><li><strong>stencil mesh</strong>: the set of all nodes or elements needed to compute the velocity or residual on the sample mesh.</li><li>Typically, the sample mesh is a subset of the stencil mesh.</li></ol><div class="m-note m-info"><p>The <code>hrUpdater</code> is an object that knows how to compute <code>a*x + b*y</code> for operands <code>x,y,</code> that (potentially) do NOT have the same size/data distribution since they are defined on stencil and sample mesh.</p></div><section id="autotoc_md123"><h3><a href="#autotoc_md123">Explain it to me better!</a></h3><p>Suppose that your FOM problem involves a 2D problem and that your FOM numerical method needs at every cell information from the nearest neighbors. For the sake of explanation, <em>it does not matter what problem we are solving</em>, only what we just said. Now, suppose that you want to try hyper-reduced LSPG on it. You come up with a sample and stencil mesh for your problem (read <a href="https://pressio.github.io/algos/hyper/">this page</a> for some information about how to select sample mesh cells), and let&#x27;s say it looks like this:</p><img class="m-image" src="lspg_sample_mesh1.png" alt="Image" style="width: 400px;" /><p>The stencil mesh is the set of <em>all</em> cells shown, while the sample mesh is the <em>subset</em> color-coded yellow. We have added an arbitrary enumeration scheme to uniquely assign a global index to each cell. The enumeration order does not matter, this is just for demonstration purposes. You have an adapter class for your problem that is able to compute the FOM right-hand-side <svg class="m-math" style="width: 0.734em; height: 1.107em; vertical-align: -0.243em;" viewBox="0 -8.302191 7.046437 10.626798">
<title>
$f$
</title>
<defs>
<path id='eq1-g0-102' d='M5.332005-4.805978C5.571108-4.805978 5.66675-4.805978 5.66675-5.033126C5.66675-5.152677 5.571108-5.152677 5.355915-5.152677H4.387547C4.614695-6.38406 4.782067-7.232877 4.877709-7.615442C4.94944-7.902366 5.200498-8.177335 5.511333-8.177335C5.762391-8.177335 6.01345-8.069738 6.133001-7.962142C5.66675-7.914321 5.523288-7.567621 5.523288-7.364384C5.523288-7.12528 5.702615-6.981818 5.929763-6.981818C6.168867-6.981818 6.527522-7.185056 6.527522-7.639352C6.527522-8.141469 6.025405-8.416438 5.499377-8.416438C4.985305-8.416438 4.483188-8.033873 4.244085-7.567621C4.028892-7.149191 3.90934-6.718804 3.634371-5.152677H2.833375C2.606227-5.152677 2.486675-5.152677 2.486675-4.937484C2.486675-4.805978 2.558406-4.805978 2.797509-4.805978H3.56264C3.347447-3.694147 2.857285-.992279 2.582316 .286924C2.379078 1.327024 2.199751 2.199751 1.601993 2.199751C1.566127 2.199751 1.219427 2.199751 1.004234 1.972603C1.613948 1.924782 1.613948 1.398755 1.613948 1.3868C1.613948 1.147696 1.43462 1.004234 1.207472 1.004234C.968369 1.004234 .609714 1.207472 .609714 1.661768C.609714 2.175841 1.135741 2.438854 1.601993 2.438854C2.82142 2.438854 3.323537 .251059 3.455044-.3467C3.670237-1.267248 4.25604-4.447323 4.315816-4.805978H5.332005Z'/>
</defs>
<g id='eq1-page1'>
<use x='0' y='0' xlink:href='#eq1-g0-102'/>
</g>
</svg> on the yellow cells, for a given FOM state <svg class="m-math" style="width: 0.639em; height: 0.778em; vertical-align: -0.243em;" viewBox="0 -5.147373 6.136656 7.47198">
<title>
$y$
</title>
<defs>
<path id='eq2-g0-121' d='M3.144209 1.338979C2.82142 1.793275 2.355168 2.199751 1.769365 2.199751C1.625903 2.199751 1.052055 2.175841 .872727 1.625903C.908593 1.637858 .968369 1.637858 .992279 1.637858C1.350934 1.637858 1.590037 1.327024 1.590037 1.052055S1.362889 .681445 1.183562 .681445C.992279 .681445 .573848 .824907 .573848 1.41071C.573848 2.020423 1.08792 2.438854 1.769365 2.438854C2.964882 2.438854 4.172354 1.338979 4.507098 .011955L5.678705-4.65056C5.69066-4.710336 5.71457-4.782067 5.71457-4.853798C5.71457-5.033126 5.571108-5.152677 5.391781-5.152677C5.284184-5.152677 5.033126-5.104857 4.937484-4.746202L4.052802-1.231382C3.993026-1.016189 3.993026-.992279 3.897385-.860772C3.658281-.526027 3.263761-.119552 2.689913-.119552C2.020423-.119552 1.960648-.777086 1.960648-1.099875C1.960648-1.78132 2.283437-2.701868 2.606227-3.56264C2.737733-3.90934 2.809465-4.076712 2.809465-4.315816C2.809465-4.817933 2.450809-5.272229 1.865006-5.272229C.765131-5.272229 .32279-3.53873 .32279-3.443088C.32279-3.395268 .37061-3.335492 .454296-3.335492C.561893-3.335492 .573848-3.383313 .621669-3.550685C.908593-4.554919 1.362889-5.033126 1.829141-5.033126C1.936737-5.033126 2.139975-5.033126 2.139975-4.638605C2.139975-4.327771 2.008468-3.981071 1.829141-3.526775C1.243337-1.960648 1.243337-1.566127 1.243337-1.279203C1.243337-.143462 2.056289 .119552 2.654047 .119552C3.000747 .119552 3.431133 .011955 3.849564-.430386L3.861519-.418431C3.682192 .286924 3.56264 .753176 3.144209 1.338979Z'/>
</defs>
<g id='eq2-page1'>
<use x='0' y='0' xlink:href='#eq2-g0-121'/>
</g>
</svg> on the stencil mesh.</p><p>For this example, you would need to create an <code>HypRedUpdater</code> object capable of performing those operations on operands that defined on the visualized sample and stencil meshes.</p><p><span class="m-text m-danger">todo</span>: explain that this is application-specific. There is nothing we can be to make this simple for generic applications, but we can simplify this for shared-mem ones and users can fully omit this for Trilinos based applications since we can use the underlying maps to figure out how to combine operators.</p></section></section>
      </div>
    </div>
  </div>
</article></main>
<div class="m-doc-search" id="search">
  <a href="#!" onclick="return hideSearch()"></a>
  <div class="m-container">
    <div class="m-row">
      <div class="m-col-m-8 m-push-m-2">
        <div class="m-doc-search-header m-text m-small">
          <div><span class="m-label m-default">Tab</span> / <span class="m-label m-default">T</span> to search, <span class="m-label m-default">Esc</span> to close</div>
          <div id="search-symbolcount">&hellip;</div>
        </div>
        <div class="m-doc-search-content">
          <form>
            <input type="search" name="q" id="search-input" placeholder="Loading &hellip;" disabled="disabled" autofocus="autofocus" autocomplete="off" spellcheck="false" />
          </form>
          <noscript class="m-text m-danger m-text-center">Unlike everything else in the docs, the search functionality <em>requires</em> JavaScript.</noscript>
          <div id="search-help" class="m-text m-dim m-text-center">
            <p class="m-noindent">Search for symbols, directories, files, pages or
            modules. You can omit any prefix from the symbol or file path; adding a
            <code>:</code> or <code>/</code> suffix lists all members of given symbol or
            directory.</p>
            <p class="m-noindent">Use <span class="m-label m-dim">&darr;</span>
            / <span class="m-label m-dim">&uarr;</span> to navigate through the list,
            <span class="m-label m-dim">Enter</span> to go.
            <span class="m-label m-dim">Tab</span> autocompletes common prefix, you can
            copy a link to the result using <span class="m-label m-dim">⌘</span>
            <span class="m-label m-dim">L</span> while <span class="m-label m-dim">⌘</span>
            <span class="m-label m-dim">M</span> produces a Markdown link.</p>
          </div>
          <div id="search-notfound" class="m-text m-warning m-text-center">Sorry, nothing was found.</div>
          <ul id="search-results"></ul>
        </div>
      </div>
    </div>
  </div>
</div>
<script src="search-v1.js"></script>
<script src="searchdata-v1.js" async="async"></script>
<footer><nav>
  <div class="m-container">
    <div class="m-row">
      <div class="m-col-l-10 m-push-l-1">
        <p>Pressio|C++. Created with <a href="https://doxygen.org/">Doxygen</a> 1.9.1 and <a href="https://mcss.mosra.cz/">m.css</a>.</p>
      </div>
    </div>
  </div>
</nav></footer>
</body>
</html>
